/* Средняя карточка между спидометрами */
.summary-card{
  background:#222;
  border-radius:12px;
  padding:14px 16px;
  box-shadow:0 2px 10px rgba(0,0,0,.35);
  width: clamp(260px, 28vw, 520px);
  flex: 1 1 clamp(260px, 28vw, 520px);
  display:flex; flex-direction:column; align-items:center; justify-content:center;
}

/* Заголовок */
.summary-title{
  margin:0 0 10px; font-size:16px; color:#ddd; letter-spacing:.2px; text-align:center;
}

/* Кольцо-процент (тонкая «пончик»-полоса) */
.summary-ring{
  --p: 78;             /* процент (JS перезапишет) */
  --th: 12px;          /* толщина кольца */
  --clr: #00d26a;      /* цвет дуги (JS перезапишет) */
  width:140px; height:140px; border-radius:50%;
  background: conic-gradient(var(--clr) calc(var(--p)*1%), #333 0);
  -webkit-mask: radial-gradient(farthest-side, transparent calc(50% - var(--th)), #000 calc(50% - var(--th) + 1px));
          mask: radial-gradient(farthest-side, transparent calc(50% - var(--th)), #000 calc(50% - var(--th) + 1px));
  position:relative;
  margin-bottom:12px;
}
.summary-ring .value{
  position:absolute; inset:0;
  display:flex; align-items:center; justify-content:center;
  color:#fff; font:700 28px/1 sans-serif;
}

/* Два KPI-бейджа под кольцом */
.kpis{
  display:grid; grid-template-columns: 1fr 1fr; gap:10px; width:100%; max-width:460px;
}
.kpi{
  background:#2a2a2a; border-radius:10px; padding:10px 12px;
  display:flex; flex-direction:column; gap:4px;
}
.kpi-label{ color:#bdbdbd; font:11px/1 sans-serif; text-transform:uppercase; letter-spacing:.3px; }
.kpi-value{ color:#eaeaea; font:700 18px/1 sans-serif; }

/* Адаптив: в один столбец на узких экранах */
@media (max-width: 900px){
  .summary-card{ width:100%; flex-basis:100%; }
  .kpis{ grid-template-columns: 1fr; }
}
<div class="summary-card">
  <div class="summary-title">Итоги</div>

  <!-- Кольцо с процентом -->
  <div class="summary-ring" id="summary-ring">
    <div class="value" id="summary-percent">0%</div>
  </div>

  <!-- Два KPI -->
  <div class="kpis">
    <div class="kpi">
      <div class="kpi-label">Резервы, ₽</div>
      <div class="kpi-value" id="kpi-rub">—</div>
    </div>
    <div class="kpi">
      <div class="kpi-label">Резервы, ТУТ</div>
      <div class="kpi-value" id="kpi-tut">—</div>
    </div>
  </div>
</div>
// ---- Константы спидометров (чтобы использовать в расчёте «общей эффективности») ----
const GAUGE_LEFT  = 70;   // Котлы
const GAUGE_RIGHT = 85;   // Турбины

// Если выше ты вызываешь drawGauge(...) уже с числами — можно оставить так:
drawGauge('gauge-1', GAUGE_LEFT);
drawGauge('gauge-2', GAUGE_RIGHT);

// ---- Константные резервы (поменяй под свои данные) ----
const RESERVES_RUB = 12400000;   // в рублях
const RESERVES_TUT = 1280;       // в ТУТ

// ---- Форматирование чисел по-русски ----
const fmtInt = d3.format(",");
const fmtRu = n => fmtInt(Math.round(n)).replace(/,/g, " ");
function fmtMoneyRu(n){
  const abs = Math.abs(n);
  if (abs >= 1e9)  return `${(n/1e9).toFixed(1).replace('.', ',')} млрд`;
  if (abs >= 1e6)  return `${(n/1e6).toFixed(1).replace('.', ',')} млн`;
  if (abs >= 1e3)  return `${(n/1e3).toFixed(1).replace('.', ',')} тыс`;
  return fmtRu(n);
}

// ---- Цвет по проценту (красный → жёлтый → зелёный) ----
const _interpRY = d3.interpolateRgb("#ff2d2d", "#ffd400");
const _interpYG = d3.interpolateRgb("#ffd400", "#00d26a");
function colorForPercent(p){
  const t = Math.max(0, Math.min(1, p/100));
  return t < 0.5 ? _interpRY(t*2) : _interpYG((t-0.5)*2);
}

// ---- Обновляем карточку «Итоги» ----
(function updateSummary(){
  const overall = (GAUGE_LEFT + GAUGE_RIGHT) / 2;           // простое среднее
  const ring = document.getElementById('summary-ring');
  const percentEl = document.getElementById('summary-percent');
  const rubEl = document.getElementById('kpi-rub');
  const tutEl = document.getElementById('kpi-tut');

  // Процент и кольцо
  ring.style.setProperty('--p', overall.toFixed(1));
  ring.style.setProperty('--clr', colorForPercent(overall));
  percentEl.textContent = `${Math.round(overall)}%`;

  // Резервы
  rubEl.textContent = `₽ ${fmtMoneyRu(RESERVES_RUB)}`;
  tutEl.textContent = fmtRu(RESERVES_TUT);
})();
