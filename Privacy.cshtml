@using Newtonsoft.Json;

<head>
    <meta charset="UTF-8">
    <title>Parameters</title>
    <!-- MathJax -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
    <style>
        body {
            background-color: black;
            color: white;
            font-family: sans-serif;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
        }

        h1 {
            color: #dddddd;
            font-size: 30px;
            margin-bottom: 20px;
        }

        .formula-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .formula-section {
            background-color: #222;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .formula-title {
            font-size: 20px;
            color: #dddddd;
            margin-bottom: 5px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }

        .formula {
            background-color: #333;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 5px;
        }

        .description {
            font-size: 14px;
            color: #cccccc;
        }

        .description ul {
            margin: 0;
            padding-left: 20px;
        }

        .parameters-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .parameter-group {
            background-color: #222;
            padding: 15px;
            flex: 1;
            min-width: 300px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #dddddd;
        }

        select, input {
            width: 100%;
            padding: 5px;
            background-color: #333;
            color: white;
            border: 1px solid #444;
            border-radius: 5px;
        }

        .btn-submit {
            background-color: #fd817e;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .btn-submit:hover {
            background-color: #ff9a97;
        }

        .correction-window {
            background-color: #2a2a2a;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #444;
            margin-top: 10px;
        }

        .correction-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #dddddd;
        }

        .correction-item {
            margin-bottom: 8px;
        }

        .correction-label {
            color: #aaaaaa;
            display: block;
            margin-bottom: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Параметры и формулы</h1>
        
        <div class="formula-container">
            <div class="formula-section">
                <div class="formula-title">Нормативный КПД котла:</div>
                <div class="formula">
                    $$\eta_{K(БР)}^{НОМ} = \eta_{K(БР)} - \Delta q_4^{W_P} - \Delta q_4^{A_R} + (t_{ХВ}^{Ф} - t_{ХВ}^{НОМ}) \cdot \Delta \eta_{K(БР)}^{ХВ}$$
                </div>
                <div class="description">
                    <ul>
                        <li>\(\eta_{K(БР)}\) — КПД котла брутто</li>
                        <li>\(\Delta q_4^{W_P}\) — поправка к \(q_4\) на влажность угля</li>
                        <li>\(\Delta q_4^{A_R}\) — поправка к \(q_4\) на зольность угля</li>
                        <li>\(t_{ХВ}^{Ф}\) — фактическая температура холодного воздуха</li>
                        <li>\(t_{ХВ}^{НОМ}\) — номинальная температура холодного воздуха</li>
                        <li>\(\Delta \eta_{K(БР)}^{ХВ}\) — поправка к КПД на 1°C</li>
                    </ul>
                </div>
            </div>
            
            <div class="formula-section">
                <div class="formula-title">Нормативный УРТ турбины:</div>
                <div class="formula">
                    $$q_{T(БР)}^{НОМ} = q_{T(БР)}^{КР} - \Delta q_{T(БР)}^{vac}$$
                </div>
                <div class="description">
                    <ul>
                        <li>\(q_{T(БР)}^{КР}\) — удельный расход тепла брутто турбины на выработку электроэнергии после капремонта</li>
                        <li>\(\Delta q_{T(БР)}^{vac}\) — поправка к удельному расходу тепла брутто на выработку электроэнергии на отклонение вакуума</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <form method="get" action="/Home/Index">
            <div class="parameters-container">
                <div class="parameter-group">
                    <label for="equipmentType">Тип оборудования:</label>
                    <select id="equipmentType" name="equipmentType">
                        <option value="turbine">Турбина</option>
                        <option value="boiler">Котёл</option>
                    </select>

                    <div class="correction-window" id="boilerCorrections">
                        <div class="correction-title">Поправки для котла:</div>
                        <div class="correction-item">
                            <label class="correction-label">$$\Delta q_4^{W_P}$$</label>
                            <input type="number" step="0.01" value="0">
                        </div>
                        <div class="correction-item">
                            <label class="correction-label">$$\Delta q_4^{A_R}$$</label>
                            <input type="number" step="0.01" value="0">
                        </div>
                        <div class="correction-item">
                            <label class="correction-label">$$(t_{ХВ}^{Ф} - t_{ХВ}^{НОМ}) \cdot \Delta \eta_{K(БР)}^{ХВ}$$</label>
                            <input type="number" step="0.01" value="0">
                        </div>
                    </div>

                    <div class="correction-window" id="turbineCorrections" style="display:none;">
                        <div class="correction-title">Поправки для турбины:</div>
                        <div class="correction-item">
                            <label class="correction-label">$$\Delta q_{T(БР)}^{vac}$$</label>
                            <input type="number" step="0.01" value="0">
                        </div>
                    </div>
                </div>

                <div class="parameter-group">
                    <label for="station">Станция:</label>
                    <select id="station" name="station">
                        <option value="25">РГРЭС</option>
                        <option value="9">ТУГРЭС</option>
                        <option value="15">БГРЭС</option>
                        <option value="1">НГРЭС</option>
                        <option value="24">КГРЭС2</option>
                        <option value="26">ПГРЭС</option>
                    </select>
                </div>

                <div class="parameter-group">
                    <label for="equipmentId">Оборудование:</label>
                    <select id="equipmentId" name="equipmentId"></select>
                </div>
            </div>
            <button type="submit" class="btn-submit">Применить параметры</button>
        </form>
    </div>

    <script>
        const equipmentTypeSelect = document.getElementById('equipmentType');
        const stationSelect = document.getElementById('station');
        const equipmentIdSelect = document.getElementById('equipmentId');
        const boilerCorrections = document.getElementById('boilerCorrections');
        const turbineCorrections = document.getElementById('turbineCorrections');

        const equipmentData = {
            turbine: {
                25: ["1","2","3","4","5","6","7","8","9","10"],
                9: ["1","2","3","4","5","6","7","8","9"],
                15: ["1","2","3","4","5","6"],
                1: ["1","2","3","4","5","6","7"],
                24: ["1","2","3","4","5","6","7","8","9","10"],
                26: ["1","2","3","4","5","6","7","8","9"]
            },
            boiler: {
                25: ["01А","01Б","02А","02Б","03А","03Б","04А","04Б","05А","05Б","06А","06Б","07","08","09","10"],
                9: ["01","02","03","04","05","06","07","08","09","10","11","12","13А","13Б","14А","14Б"],
                15: ["01А","01Б","02А","02Б","03А","03Б","04А","04Б","05А","05Б","06А","06Б"],
                1: ["01А","01Б","02А","02Б","03А","03Б","04А","04Б","05А","05Б","06А","06Б","07А","07Б"],
                24: ["01А","01Б","02А","02Б","03А","03Б","04А","04Б","05А","05Б","06А","06Б","07А","07Б","08А","08Б","09А","09Б","10А","10Б"],
                26: ["01А","01Б","02А","02Б","03А","03Б","04А","04Б","05","06","07","08","09"]
            }
        };

        function updateEquipmentList() {
            const type = equipmentTypeSelect.value;
            const station = stationSelect.value;
            equipmentIdSelect.innerHTML = '';
            if (equipmentData[type] && equipmentData[type][station]) {
                equipmentData[type][station].forEach(id => {
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = (type === 'turbine' ? 'ТА' : 'КА') + id;
                    equipmentIdSelect.appendChild(option);
                });
            }
            if (type === 'turbine') {
                turbineCorrections.style.display = 'block';
                boilerCorrections.style.display = 'none';
            } else {
                turbineCorrections.style.display = 'none';
                boilerCorrections.style.display = 'block';
            }
            // Перерисовываем формулы MathJax
            if (window.MathJax) {
                MathJax.typesetPromise();
            }
        }

        equipmentTypeSelect.addEventListener('change', updateEquipmentList);
        stationSelect.addEventListener('change', updateEquipmentList);

        // Первичная инициализация
        updateEquipmentList();
    </script>
</body>
